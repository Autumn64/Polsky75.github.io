<!DOCTYPE html>
<html>
<head>
	<meta charset="UTF-8">
	<title id="str">Ешь яблоки!</title>
</head>
<body>
  <canvas id = "canvas" width = "700" height = "500"></canvas> 
	<script src="https://code.jquery.com/jquery-2.1.0.js"></script>
	<script>
   	var canvas = document.getElementById("canvas");
	var ctx = canvas.getContext("2d");
	var w = 500
	var h = 500
	var colours = ["Red","Blue","Yellow"]
	var linker = 0
	var blockSize = 10
	var blockW = w/blockSize
	var blockH = h/blockSize
	var score = 0
	var draw_points = function (massive,n) {
	ctx.lineWidth = 2
	for (var i = 0; i < massive.length;i++) {
		ctx.beginPath();
		ctx.moveTo(massive[i][0],massive[i][1]);
		if(i+1<massive.length){
		ctx.lineTo(massive[i+1][0],massive[i+1][1]);
		ctx.stroke();
		}
		}
	
	}
	var circle = function (x,y,radius,fillCircle) {
  	ctx.beginPath();
  	ctx.arc(x, y, radius, 0, Math.PI * 2, false);
	if(fillCircle === true){
    	ctx.fill();
	}else{
	ctx.stroke();
	}
  	}
	var drawBorder = function(){
	ctx.fillStyle = "Gray"
	ctx.fillRect(0,0,w,blockSize)
	ctx.fillRect(0,h-blockSize,w,blockSize)
	ctx.fillRect(0,0,blockSize,h)
	ctx.fillRect(w-blockSize,0,blockSize,h)
	};
	var drawScore = function(){
	ctx.font = "20px courier";
	ctx.fillStyle = "Black";
	ctx.textAlign = "Left";
	ctx.textBaseline = "top";
	ctx.fillText("Счет: " + score,blockSize,blockSize)
	}
	var gameOver = function(){
	clearInterval(intervalId)
	ctx.font = "60px courier";
	ctx.fillStyle = "Black";
	ctx.textAlign = "center";
	ctx.textBaseline = "middle";
	ctx.fillText("Конец игры", w/2, h/2);
	}
	//var xScore = setInterval(function(){
	//ctx.clearRect(0,0,w,h)
	//score++
	//drawBorder();
	//drawScore();
	//}, 100)
	var Block = function (col,row){
	this.col = col
	this.row = row
	};
	Block.prototype.drawSquare = function(colour){
	var x = this.col * blockSize;
	var y = this.row * blockSize;
	ctx.fillStyle = colour;
	ctx.fillRect(x, y, blockSize, blockSize)
	}
	Block.prototype.drawCircle = function(colour){
	var centerX = this.col * blockSize + blockSize/2;
	var centerY = this.row * blockSize + blockSize/2;
	ctx.fillStyle = colour;
	circle(centerX, centerY, blockSize/2, true)
	}
	Block.prototype.equal = function(otherBlock){
	return this.col === otherBlock.col && this.row === otherBlock.row
	};
	var Snake = function(){
	this.cegments = [
	new Block(7,5),
	new Block(6,5),
	new Block(5,5)
	];
	this.direction = "right";
	this.nextDirection = "right";
	};
	var choose = function(){
	if (linker===0){
	linker = 1
	return
	}else if (linker===1){
	linker = 2
	return
	}else if (linker===2){
	linker = 0
	return
	}
	}
	Snake.prototype.draw = function(){
	for (var i = 0; i < this.cegments.length; i++){
	//this.cegments[i].drawSquare(colours[linker]);
	//choose();
	this.cegments[i].drawSquare("lime");
	}
	};
	Snake.prototype.move = function(){
	var head = this.cegments[0];
	var newHead;
	this.direction = this.nextDirection
	if (this.direction === "right") {
	newHead = new Block(head.col + 1, head.row);
	} else if (this.direction === "down") {
	newHead = new Block(head.col, head.row + 1);
	} else if (this.direction === "left") {
	newHead = new Block(head.col - 1, head.row);
	} else if (this.direction === "up") {
	newHead = new Block(head.col, head.row - 1);
	};
	if (this.checkCollision(newHead)){
	gameOver();
	return
	};
	this.cegments.unshift(newHead);
	if (newHead.equal(apple.position)){
	score++;
	apple.move();
	}else{
	this.cegments.pop();
	}
	};
	Snake.prototype.checkCollision = function(head){
	var leftCollision = (head.col === 0);
	var topCollision = (head.row === 0);
	var rightCollision = (head.col === blockW - 1)
	var bottomCollision = (head.row === blockH - 1)
	var wallCollision = leftCollision||topCollision||rightCollision||bottomCollision
	var selfCollision = false;
	for (var i = 0; i < this.cegments.length; i++){
	if (head.equal(this.cegments[i])){
		selfCollision = true
	}
	}
	return wallCollision || selfCollision
	};
	Snake.prototype.setDirection = function(newDirection){
	if (this.direction==="up" && newDirection==="down"){
	return;
	}else if (this.direction==="right" && newDirection==="left"){
	return;
	}else if (this.direction==="down" && newDirection==="up"){
	return;
	}else if (this.direction==="left" && newDirection==="right"){
	return;
	}
	this.nextDirection = newDirection;
	};
	var Apple = function(){
	this.position = new Block(10,10);
	};
	Apple.prototype.draw = function(){
	this.position.drawCircle("limeGreen");
	};
	Apple.prototype.move = function(){
	var randomCol = Math.floor(Math.random()*(blockW-2))+1;
	var randomRow = Math.floor(Math.random()*(blockH-2))+1;
	this.position = new Block(randomCol, randomRow)
	};
	var L = [[540,250],[510,250],[520,245],[510,250],[520,255]]
	var snake = new Snake();
	var apple = new Apple();
	var intervalId = setInterval(function(){
	ctx.clearRect(0,0,w,h)
	drawScore();
	snake.move();
	snake.draw();
	apple.draw();
	drawBorder();
	ctx.fillStyle = "Red"
	circle(525,250,20,true)
	circle(525,250,20,false)
	draw_points(L)
	ctx.fillStyle = "Blue"
	circle(595,250,20,true)
	circle(595,250,20,false)
	ctx.fillStyle = "Fuchsia"
	circle(560,215,20,true)
	circle(560,215,20,false)
	ctx.fillStyle = "Orange"
	circle(560,285,20,true)
	circle(560,285,20,false)
	}, 100);
	var directions = {
	37: "left",
	38: "up",
	39: "right",
	40: "down"
	};
	$("body").keydown(function(event){
	var newDirection = directions[event.keyCode];
	if (newDirection !== undefined){
	snake.setDirection(newDirection)
	}
	});
	</script>
</body>
</html>
